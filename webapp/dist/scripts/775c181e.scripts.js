"use strict";angular.module("webappApp",["ngResource","ngCookies","ngSanitize","ngRoute","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("webappApp").factory("Version",["$resource",function(a){return a("/api/version")}]),angular.module("webappApp").factory("Schedules",["$http","$q",function(a,b){function c(a,b){var c=angular.copy(a);return angular.forEach(c,function(a){a.zone=b}),c}function d(a,b){return angular.forEach(b,function(b,c){c&&"$"!==c[0]&&(a[c]=b)}),a}function e(a){return a.isLocal?"/api/schedules":"/api/zones/"+a.name+"/schedules"}return{query:function(d){var e=b.defer(),f=d.isLocal?"/api/schedules/":"/api/zones/"+d.name+"/schedules/";return a.get(f).success(function(a){e.resolve(c(a,d))}),e.promise},setOne:function(c){var f=b.defer(),g=e(c.zone)+"/"+c.originalName;return a.put(g,c).success(function(a){f.resolve(d(c,a))}),f.promise},addOne:function(c){var f=b.defer(),g=e(c.zone)+"/";return a.post(g,c).success(function(a){f.resolve(d(c,a))}),f.promise},deleteOne:function(c){var f=b.defer(),g=e(c.zone)+"/"+c.name;return a.delete(g,c).success(function(a){f.resolve(d(c,a))}),f.promise}}}]),angular.module("webappApp").factory("Switches",["$http","$q",function(a,b){function c(a,b){var c=angular.copy(a);return angular.forEach(c,function(a){a.zone=b}),c}function d(a,b){return angular.forEach(b,function(b,c){c&&"$"!==c[0]&&(a[c]=b)}),a}function e(a,b){angular.forEach(a,function(a){var c=_.findWhere(b,{name:a.name});d(a,c)})}return{query:function(d){var e=b.defer(),f=d.isLocal?"/api/switches/":"/api/zones/"+d.name+"/switches/";return a.get(f).success(function(a){e.resolve(c(a,d))}),e.promise},setOne:function(c,e){var f=b.defer(),g=angular.copy(c),h=c.zone,i=h.isLocal?"/api/switches/"+c.name:"/api/zones/"+h.name+"/switches/"+c.name;return g.value=e,a.put(i,g).success(function(a){f.resolve(d(c,a))}),f.promise},setAll:function(c,d){var f=b.defer(),g=c[0].zone,h=g.isLocal?"/api/switches/":"/api/zones/"+g.name+"/switches/";return angular.forEach(c,function(a){a.value=d}),a.put(h,c).success(function(a){f.resolve(e(c,a))}),f.promise}}}]),angular.module("webappApp").factory("Zones",["$http","$q",function(a,b){return{query:function(){var c=b.defer(),d="/api/zones/";return a.get(d).success(function(a){var b=[{name:"Local",isLocal:!0}];c.resolve(b.concat(a))}),c.promise}}}]),angular.module("webappApp").controller("AboutCtrl",["$scope","$modalInstance","Version",function(a,b,c){a.version=c.get(),a.close=function(){b.dismiss("cancel")}}]),angular.module("webappApp").controller("HomeCtrl",["$scope","Zones","Switches","Schedules","$modal",function(a,b,c,d,e){function f(){c.query(a.currentZone).then(function(b){a.switches=b})}function g(){d.query(a.currentZone).then(function(b){a.schedules=b})}b.query().then(function(b){a.zones=b,a.currentZone=a.zones[0]}),a.$watch("currentZone",function(){a.currentZone&&(f(),g())}),a.toggleSwitch=function(a){c.setOne(a,0===a.value?1:0)},a.setSwitches=function(b){c.setAll(a.switches,b)},a.editSchedule=function(b){b||(b={zone:a.currentZone,switches:_.map(a.switches,function(a){return a.value=null,a})}),e.open({templateUrl:"views/schedule_edit.html",controller:"ScheduleEditCtrl",resolve:{schedule:function(){return b},schedules:function(){return a.schedules}}})},a.showAbout=function(){e.open({templateUrl:"views/about.html",controller:"AboutCtrl"})}}]),angular.module("webappApp").controller("ScheduleEditCtrl",["$scope","$modalInstance","schedule","schedules","Schedules",function(a,b,c,d,e){function f(a,b){return angular.forEach(b,function(b,c){c&&"$"!==c[0]&&(a[c]=b)}),a}a.original=c,a.schedule=angular.copy(c),a.switchOptions=[{name:"No change",value:null},{name:"On",value:0},{name:"Off",value:1}],a.schedule.switches=_.map(a.schedule.switches,function(b){return b.selectValue=_.findWhere(a.switchOptions,{value:b.value}),b}),a.cancel=function(){b.dismiss("cancel")},a.ok=function(){a.schedule.originalName=a.original.name,_.each(a.schedule.switches,function(a){a.value=a.selectValue.value}),a.original.name?e.setOne(a.schedule).then(function(c){f(a.original,c),b.close(a.original)}):e.addOne(a.schedule).then(function(c){f(a.original,c),d.push(a.original),b.close(a.original)})},a.delete=function(){e.deleteOne(a.original).then(function(a){var c=d.indexOf(_.findWhere(d,{name:a.name}));c>=0&&d.splice(c,1),b.close()})}}]),angular.module("webappApp").directive("lcScheduleEdit",function(){return{restrict:"E",templateUrl:"views/schedule_edit.html",scope:{schedule:"="}}}),angular.module("webappApp").directive("lcScheduleList",function(){return{restrict:"E",templateUrl:"views/schedule_list.html",scope:{schedules:"=",editSchedule:"="}}}),angular.module("webappApp").directive("lcSwitchList",function(){return{restrict:"E",templateUrl:"views/switch_list.html",scope:{switches:"=",toggleSwitch:"=",setSwitches:"="}}}),angular.module("webappApp").directive("lcZoneSelect",function(){return{restrict:"E",templateUrl:"views/zone_select.html",scope:{zones:"=",currentZone:"="}}}),angular.module("webappApp").directive("lcZoneBanner",function(){return{restrict:"E",templateUrl:"views/zone_banner.html",scope:{currentZone:"="}}});