"use strict";angular.module("webappApp",["ngResource","ngCookies","ngSanitize","ngRoute","ui.bootstrap","switchesServices","schedulesServices","aboutServices"]).config(["$routeProvider",function(a){a.when("/switches",{templateUrl:"views/switches.html",controller:"SwitchesCtrl"}).when("/schedules",{templateUrl:"views/schedules.html",controller:"SchedulesCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/switches"})}]);var switchesServices=angular.module("switchesServices",["ngResource"]);switchesServices.factory("Switches",["$resource","$http",function(a,b){var c=a("/api/switches/");return angular.extend(c.prototype,{$update:function(){return b.put("/api/switches/",_.toArray(this))}}),c}]),switchesServices.factory("Switch",["$resource",function(a){return a("/api/switches/:name",{name:"@name"},{update:{method:"PUT"}})}]);var schedulesServices=angular.module("schedulesServices",["ngResource"]);schedulesServices.factory("Schedules",["$resource",function(a){return a("/api/schedules/")}]),schedulesServices.factory("Schedule",["$resource","$http",function(a,b){var c=a("/api/schedules/:originalName",{originalName:"@originalName"},{update:{method:"PUT"}});return angular.extend(c.prototype,{$save:function(){return b.post("/api/schedules/",this)}}),c}]);var aboutServices=angular.module("aboutServices",["ngResource"]);aboutServices.factory("Version",["$resource",function(a){return a("/api/version")}]),angular.module("webappApp").controller("SwitchesCtrl",["$scope","Switches","Switch",function(a,b,c){function d(c){var d=[];angular.forEach(a.switches,function(a){this.push(angular.extend({},a,{value:c}))},d);var e=new b(d);e.$update().then(function(b){a.switches=b.data})}a.switches=b.query(),a.toggleSwitch=function(){var a,b=this;a=new c(angular.extend({},b.switch,{value:0===b.switch.value?1:0})),a.$update().then(function(){b.switch=a})},a.turnAllSwitchesOn=function(){d(0)},a.turnAllSwitchesOff=function(){d(1)}}]);var webAppModule=angular.module("webappApp");webAppModule.controller("ScheduleEditModalCtrl",["$scope","$modalInstance","schedule",function(a,b,c){a.originalName=c.name,a.schedule=c,a.switchOptions=[{name:"No change",value:null},{name:"On",value:0},{name:"Off",value:1}],a.schedule.switches=_.map(a.schedule.switches,function(b){return b.selectValue=_.findWhere(a.switchOptions,{value:b.value}),b}),a.ok=function(){_.each(a.schedule.switches,function(a){a.value=a.selectValue.value}),b.close(a.schedule)},a.cancel=function(){b.dismiss("cancel")}}]),webAppModule.controller("ScheduleDeleteModalCtrl",["$scope","$modalInstance","schedule",function(a,b,c){a.schedule=c,a.ok=function(){b.close(a.schedule)},a.cancel=function(){b.dismiss("cancel")}}]),webAppModule.controller("SchedulesCtrl",["$scope","Switches","Schedules","Schedule","$modal",function(a,b,c,d,e){a.schedules=c.query(),a.add=function(){var c,f={};b.query(function(b){f={switches:_.map(b,function(a){return a.value=null,a})},c=e.open({templateUrl:"views/schedule_modal.html",controller:"ScheduleEditModalCtrl",resolve:{schedule:function(){return f}}}),c.result.then(function(b){b.originalName=b.name,new d(b).$save().then(function(b){a.schedules.push(b.data)})})})},a.open=function(){var a,b=this;a=e.open({templateUrl:"views/schedule_modal.html",controller:"ScheduleEditModalCtrl",resolve:{schedule:function(){return angular.copy(b.schedule)}}}),a.result.then(function(a){a.originalName=b.schedule.name,new d(a).$update().then(function(a){b.schedule=a})})},a.delete=function(){var b,c=this;b=e.open({templateUrl:"views/schedule_delete_modal.html",controller:"ScheduleDeleteModalCtrl",resolve:{schedule:function(){return angular.copy(c.schedule)}}}),b.result.then(function(b){b.originalName=b.name,new d(b).$delete().then(function(){var c=a.schedules.indexOf(_.findWhere(a.schedules,{name:b.name}));c>=0&&a.schedules.splice(c,1)})})}}]),angular.module("webappApp").controller("AboutCtrl",["$scope","Version",function(a,b){a.version=b.get()}]);