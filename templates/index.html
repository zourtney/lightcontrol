<!DOCTYPE html>
<head>
	<title>LightControl</title>
	<meta id="viewport" name="viewport" content="user-scalable=no, width=device-width, height=device-height" />
	<link rel="stylesheet" href="style.css" />
	<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
	<script type="text/javascript">
		var ON = 0,
		    OFF = 1;

		var showLightStatus = function(e, value) {
			e.data('value', value);
			e[value === ON ? 'addClass' : 'removeClass']('on');
		};

		$(document).ready(function() {
			// Initialize all lights
			$.get('/outlets/', function(data) {
				for (var i = 0; i < data.length; i++) {
					showLightStatus($('.outlet[data-id="' + data[i].id + '"]'), data[i].value);
				}
			});

			// Set up click listeners on each
			$('.outlet').on('click', function(e) {
				var e = $(e.currentTarget);
				$.ajax({
					type: 'PUT',
					url: '/outlets/' + e.data('id') + '/',
					contentType: 'application/json',
					data: JSON.stringify({
						id: e.data('id'),
						value: e.data('value') === ON ? OFF : ON
					}),
					success: function(data) {
						showLightStatus(e, data.value);
					}
				});
			});

			$('.switch.all-on, .switch.all-off').on('click', function(e) {
				var val = $(e.currentTarget).hasClass('all-on') ? ON : OFF;

				$.ajax({
					type: 'PUT',
					url: '/outlets/',
					contentType: 'application/json',
					data: JSON.stringify([
						{id: 1, value: val},
						{id: 2, value: val},
						{id: 3, value: val},
						{id: 4, value: val}
					]),
					success: function(data) {
						for (var i = 0; i < data.length; i++) {
							showLightStatus($('.outlet[data-id="' + data[i].id + '"]'), data[i].value);
						}
					}
				});
			});
		});
	</script>
</head>
<body>
	<!--<h1>Greetings from {{planet}}!</h1>-->
	<div class="group individual">
		<div class="row">
			<div class="outlet" data-id="1"></div>
			<div class="outlet" data-id="3"></div>
		</div>
		<div class="row">
			<div class="outlet" data-id="2"></div>
			<div class="outlet" data-id="4"></div>
		</div>
	</div>
	<div class="group all">
		<button class="switch all-on">All on</button>
		<button class="switch all-off">All off</button>
	</div>
</body>
</html>